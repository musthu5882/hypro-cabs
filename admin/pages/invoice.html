<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypro Cabs Invoice</title>
    
    <!-- Base Styles -->
    <link rel="stylesheet" href="../assets/css/base.css">
    <link rel="stylesheet" href="../assets/css/layout.css">
    <link rel="stylesheet" href="../assets/css/pages/invoice.css">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Toggle Button -->
    <button id="toggleSidebar" class="toggle-btn no-print" onclick="toggleEditor()">
        <i class="fa-solid fa-expand"></i> <span>Hide Editor</span>
    </button>

    <div class="invoice-app-wrapper">

        <!-- LEFT SIDE: EDITOR PANEL -->
        <div class="editor-sidebar no-print" id="editorPanel">
            <div class="editor-header">
                <h3>üìù Invoice Data Entry</h3>
            </div>
            
            <div class="form-scroll">
                
                <!-- Section 1: Trip Basic Info -->
                <div class="form-section">
                    <label class="section-label">TRIP INFO</label>
                    <div class="form-row">
                        <div class="col"><label>Invoice No</label><input type="text" id="in_inv_no" value="INV-001" oninput="updateInvoice()"></div>
                        <div class="col"><label>Date</label><input type="date" id="in_date_now" onchange="updateInvoice()"></div>
                    </div>
                    <div class="form-group">
                        <label>Trip Type</label>
                        <input type="text" id="in_trip_type" list="tripTypes" placeholder="Select or Type" oninput="updateInvoice()">
                        <datalist id="tripTypes">
                            <option value="Local Trip">
                            <option value="Outstation">
                            <option value="Airport Transfer">
                            <option value="Package Trip">
                        </datalist>
                    </div>
                </div>

                <!-- Section 2: Vehicle & Driver -->
                <div class="form-section">
                    <label class="section-label">VEHICLE & DRIVER</label>
                    <div class="form-row">
                        <div class="col"><label>Vehicle No</label><input type="text" id="in_veh_no" oninput="updateInvoice()" placeholder="KL-00-AB-0000"></div>
                        <div class="col"><label>Veh Type</label><input type="text" id="in_veh_type" oninput="updateInvoice()" placeholder="Sedan/Innova"></div>
                    </div>
                    <div class="form-group">
                        <label>Driver Name</label>
                        <input type="text" id="in_driver" oninput="updateInvoice()" placeholder="Driver Name">
                    </div>
                </div>

                <!-- Section 3: Guest & Route -->
                <div class="form-section">
                    <label class="section-label">GUEST & ROUTE</label>
                    <div class="form-group"><label>Guest Name</label><input type="text" id="in_cust" oninput="updateInvoice()"></div>
                    <div class="form-group"><label>Company (Optional)</label><input type="text" id="in_company" oninput="updateInvoice()"></div>
                    
                    <div class="form-row">
                        <div class="col"><label>Pickup Loc</label><input type="text" id="in_from" oninput="updateInvoice()"></div>
                        <div class="col"><label>Drop Loc</label><input type="text" id="in_to" oninput="updateInvoice()"></div>
                    </div>
                    <div class="form-group">
                        <label>Visited Places (Via)</label>
                        <input type="text" id="in_via" oninput="updateInvoice()" placeholder="Optional">
                    </div>
                </div>

                <!-- Section 4: Readings (Auto Calc) -->
                <div class="form-section highlight-bg">
                    <label class="section-label">READINGS (AUTO CALCULATE)</label>
                    <div class="form-row">
                        <div class="col"><label>Start KM</label><input type="number" id="in_start_km" oninput="calcReadings()"></div>
                        <div class="col"><label>Close KM</label><input type="number" id="in_close_km" oninput="calcReadings()"></div>
                    </div>
                    <div class="result-display">Total KM: <span id="res_total_km">0</span></div>

                    <div class="form-row mt-2">
                        <div class="col"><label>Start Time</label><input type="datetime-local" id="in_start_time" oninput="calcReadings()"></div>
                        <div class="col"><label>Close Time</label><input type="datetime-local" id="in_end_time" oninput="calcReadings()"></div>
                    </div>
                    <div class="result-display">Duration: <span id="res_duration">0 Days 0 Hrs</span></div>
                </div>

                <!-- Section 5: Fare & Extras -->
                <div class="form-section">
                    <label class="section-label">FARE & EXTRAS</label>
                    
                    <!-- NEW FIELD: RATE STRUCTURE -->
                    <div class="form-group">
                        <label>Rate / Fare Details (Structure)</label>
                        <input type="text" id="in_rate_note" oninput="updateInvoice()" placeholder="Eg: ‚Çπ15/km, Min 100km">
                    </div>

                    <div class="form-group"><label>Base Fare / Rent</label><input type="number" id="in_base" oninput="calcTotal()"></div>
                    <div class="form-row">
                        <div class="col"><label>Toll/Parking</label><input type="number" id="in_extra" oninput="calcTotal()"></div>
                        <div class="col"><label>Discount</label><input type="number" id="in_discount" oninput="calcTotal()"></div>
                    </div>
                    <div class="form-group">
                        <label>Payment Mode</label>
                        <select id="in_pay_mode" onchange="updateInvoice()">
                            <option value="CASH">CASH</option>
                            <option value="ONLINE">ONLINE / UPI</option>
                            <option value="CREDIT">CREDIT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Driver Note / Remarks</label>
                        <textarea id="in_note" rows="2" oninput="updateInvoice()" placeholder="Eg: AC was off for 1hr..."></textarea>
                    </div>
                </div>

                <div class="action-bar">
                    <button class="btn-print" onclick="window.print()">
                        <i class="fa-solid fa-print"></i> Print A5 Invoice
                    </button>
                    <button class="btn-back" onclick="window.location.href='trip-fare.html'">Back</button>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDE: PREVIEW AREA -->
        <div class="preview-container">
            <div class="invoice-paper">
                
                <!-- BLOCK 1: COMPANY HEADER -->
                <div class="inv-block header-block">
                    <div class="logo-area">
                        <h1>HYPRO CABS</h1>
                        <p class="brand-tagline">Professional Taxi Service ‚Äì Calicut</p>
                        <p>Vengeri, Kozhikode, Kerala - 673010</p>
                        <p>Mob: <strong>+91 73062 87662</strong></p>
                    </div>
                </div>

                <!-- BLOCK 2: INVOICE META -->
                <div class="inv-block meta-block">
                    <div class="meta-row">
                        <span>INVOICE NO:</span> <strong id="out_inv_no" class="hilite">INV-001</strong>
                    </div>
                    <div class="meta-row">
                        <span>DATE:</span> <strong id="out_date">--/--/----</strong>
                    </div>
                    <div class="meta-row">
                        <span>TYPE:</span> <strong id="out_trip_type">--</strong>
                    </div>
                </div>

                <!-- BLOCK 3: GUEST & VEHICLE -->
                <div class="inv-block grid-block">
                    <div class="half-box border-r">
                        <label class="box-label">GUEST DETAILS</label>
                        <h3 id="out_cust">Guest Name</h3>
                        <p id="out_company">Company Name</p>
                    </div>
                    <div class="half-box">
                        <label class="box-label">VEHICLE & DRIVER</label>
                        <h3 id="out_veh_no">KL-00-AB-0000</h3>
                        <p><span id="out_veh_type">Sedan</span></p>
                        <p class="driver-row"><i class="fa-solid fa-id-card"></i> <span id="out_driver">Driver Name</span></p>
                    </div>
                </div>

                <!-- BLOCK 4: ROUTE -->
                <div class="inv-block route-block">
                    <label class="box-label">TRIP ROUTE</label>
                    <div class="route-flex">
                        <div class="route-point">
                            <i class="fa-solid fa-circle-dot start-icon"></i>
                            <span id="out_from">Origin</span>
                        </div>
                        <div class="route-line"></div>
                        <div class="route-point" id="div_via" style="display:none;">
                            <i class="fa-solid fa-location-dot via-icon"></i>
                            <span id="out_via">Via</span>
                            <div class="route-line"></div>
                        </div>
                        <div class="route-point">
                            <i class="fa-solid fa-location-dot end-icon"></i>
                            <span id="out_to">Destination</span>
                        </div>
                    </div>
                </div>

                <!-- BLOCK 5: METER READINGS -->
                <div class="inv-block meter-block">
                    <table class="readings-table">
                        <thead>
                            <tr>
                                <th width="20%">PARTICULARS</th>
                                <th width="30%">STARTING</th>
                                <th width="30%">CLOSING</th>
                                <th width="20%">TOTAL</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>KILOMETER</strong></td>
                                <td id="out_start_km">0</td>
                                <td id="out_close_km">0</td>
                                <td><strong id="out_total_km">0</strong> KM</td>
                            </tr>
                            <tr>
                                <td><strong>TIME</strong></td>
                                <td id="out_start_dt" class="small-dt">--</td>
                                <td id="out_end_dt" class="small-dt">--</td>
                                <td><strong id="out_duration">--</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- BLOCK 6: FARE DETAILS -->
                <div class="inv-block fare-block">
                    
                    <!-- New Rate Note Display -->
                    <div class="rate-info" id="div_rate_note" style="display:none;">
                        <span class="rate-label">Rate Applied:</span> <span id="out_rate_note">--</span>
                    </div>

                    <table class="fare-table">
                        <thead>
                            <tr>
                                <th>DESCRIPTION</th>
                                <th class="text-right">AMOUNT (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Base Fare / Rent Charges</td>
                                <td class="text-right" id="out_base">0.00</td>
                            </tr>
                            <tr id="row_extra" style="display:none">
                                <td>Toll, Parking & Permit Charges</td>
                                <td class="text-right" id="out_extra">0.00</td>
                            </tr>
                            <tr id="row_disc" style="display:none; color: red;">
                                <td>Less: Discount</td>
                                <td class="text-right">- <span id="out_disc">0.00</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- BLOCK 7: GRAND TOTAL (Highlighted) -->
                <div class="total-block">
                    <div class="total-label">
                        GRAND TOTAL <span class="pay-tag" id="out_pay_mode">CASH</span>
                    </div>
                    <div class="total-amount">
                        ‚Çπ <span id="out_total">0.00</span>
                    </div>
                </div>

                <!-- NOTES SECTION -->
                <div class="notes-section" id="div_note" style="display:none;">
                    <strong>Note:</strong> <span id="out_note"></span>
                </div>

                <!-- SIGNATURE SECTION -->
                <div class="signature-section">
                    <div class="sig-box">
                        <div class="line"></div>
                        <p>DRIVER SIGNATURE</p>
                    </div>
                    <div class="sig-box">
                        <div class="line"></div>
                        <p>GUEST SIGNATURE</p>
                    </div>
                </div>

                <div class="footer-note">Thank you for choosing Hypro Cabs!</div>

            </div>
        </div>
    </div>

    <script src="../assets/js/pages/invoice.js"></script>
</body>
</html>
<script type="module" src="./assets/js/core/auth.js"></script>
